---
phase: 04-real-time-ui-visibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/code/code-viewer.tsx
  - apps/web/components/chat/tool-block.tsx
autonomous: true

must_haves:
  truths:
    - "User can view code changes the agent made in real-time as they happen"
    - "Code viewer displays file content with syntax highlighting"
    - "Code viewer integrates into tool-block component for file edits"
  artifacts:
    - path: "apps/web/components/code/code-viewer.tsx"
      provides: "Monaco Editor-based code viewer component"
      min_lines: 50
      exports: ["CodeViewer"]
    - path: "apps/web/components/chat/tool-block.tsx"
      provides: "Tool call display with integrated code viewer"
      contains: "CodeViewer"
  key_links:
    - from: "apps/web/components/chat/tool-block.tsx"
      to: "apps/web/components/code/code-viewer.tsx"
      via: "import CodeViewer"
      pattern: "import.*CodeViewer"
---

<objective>
Create Monaco Editor-based code viewer component and integrate it into tool-block for displaying agent file changes.

Purpose: Enable users to see code modifications in real-time as the agent makes edits, providing visibility into what's changing.
Output: CodeViewer component and enhanced tool-block with inline code viewing
</objective>

<execution_context>
@/Users/dylansteck/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/dylansteck/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-real-time-ui-visibility/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CodeViewer component with Monaco Editor</name>
  <files>apps/web/components/code/code-viewer.tsx</files>
  <action>
Create new CodeViewer component using @monaco-editor/react (already in stack).

Component should:
- Accept props: filePath (string), content (string), language (optional string), readOnly (boolean, default true)
- Auto-detect language from file extension if not provided (ts/tsx → typescript, js/jsx → javascript, etc.)
- Use Monaco Editor with theme "vs-dark" (or "vs" for light mode based on theme)
- Configure options: readOnly, minimap disabled, fontSize 14, lineNumbers on, wordWrap on
- Handle loading state while Monaco initializes
- Export as named export "CodeViewer"

Follow existing component patterns from apps/web/components (use 'use client', proper TypeScript interfaces).

Reference RESEARCH.md Pattern 1 for implementation details.
</action>
  <verify>
File exists at apps/web/components/code/code-viewer.tsx with CodeViewer component exported. Component accepts filePath, content, language, readOnly props. Monaco Editor renders with correct theme and options.
</verify>
  <done>
CodeViewer component created and exports CodeViewer function. Component accepts required props and renders Monaco Editor with syntax highlighting.
</done>
</task>

<task type="auto">
  <name>Task 2: Integrate CodeViewer into tool-block component</name>
  <files>apps/web/components/chat/tool-block.tsx</files>
  <action>
Enhance existing tool-block.tsx to display code changes using CodeViewer.

When tool call is a file write/edit/create operation:
- Detect file operations from tool name or arguments (e.g., "write_file", "edit_file", "create_file")
- Extract file path and content from tool arguments
- Display CodeViewer in collapsible section within tool-block
- Show file path as header, CodeViewer below
- Make CodeViewer read-only (agent changes, not user edits)

Preserve existing tool-block functionality (collapsible, tool name display, etc.). Add CodeViewer import and conditional rendering based on tool type.

Reference existing tool-block.tsx structure and RESEARCH.md Pattern 1.
</action>
  <verify>
tool-block.tsx imports CodeViewer. File write/edit/create tool calls display CodeViewer with file content. CodeViewer shows syntax-highlighted code. Existing tool-block functionality preserved.
</verify>
  <done>
CodeViewer integrated into tool-block. File operations display code viewer inline. Code is syntax-highlighted and read-only.
</done>
</task>

</tasks>

<verification>
- CodeViewer component exists and renders Monaco Editor
- tool-block displays CodeViewer for file operations
- Code syntax highlighting works for common languages (TypeScript, JavaScript, etc.)
- CodeViewer is read-only (no editing)
</verification>

<success_criteria>
User can see code changes in tool-block when agent modifies files. Code is syntax-highlighted and displayed in Monaco Editor. Component is reusable for other code viewing needs.
</success_criteria>

<output>
After completion, create `.planning/phases/04-real-time-ui-visibility/04-01-SUMMARY.md`
</output>
