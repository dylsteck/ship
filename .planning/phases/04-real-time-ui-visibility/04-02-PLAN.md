---
phase: 04-real-time-ui-visibility
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/diff/diff-viewer.tsx
  - apps/web/components/session/session-panel.tsx
autonomous: true

must_haves:
  truths:
    - "User can view Git diffs showing what changed in the codebase"
    - "Diff viewer displays changes in readable format with syntax highlighting"
    - "Diff viewer accessible from session panel after commits"
  artifacts:
    - path: "apps/web/components/diff/diff-viewer.tsx"
      provides: "Git diff visualization component"
      min_lines: 60
      exports: ["DiffViewer"]
    - path: "apps/web/components/session/session-panel.tsx"
      provides: "Session panel with diff viewer integration"
      contains: "DiffViewer"
  key_links:
    - from: "apps/web/components/session/session-panel.tsx"
      to: "apps/web/components/diff/diff-viewer.tsx"
      via: "import DiffViewer"
      pattern: "import.*DiffViewer"
---

<objective>
Create Git diff viewer component using @git-diff-view/react and integrate it into session panel for displaying codebase changes.

Purpose: Show users what changed in their codebase after agent commits, providing visibility into modifications before PR creation.
Output: DiffViewer component and session panel integration
</objective>

<execution_context>
@/Users/dylansteck/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/dylansteck/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-real-time-ui-visibility/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DiffViewer component with @git-diff-view/react</name>
  <files>apps/web/components/diff/diff-viewer.tsx</files>
  <action>
Create new DiffViewer component using @git-diff-view/react and @git-diff-view/file (already in stack).

Component should:
- Accept props: diff (string) - raw Git diff output
- Parse diff string into FileData[] using @git-diff-view/file parseDiff function
- Render DiffView component from @git-diff-view/react for each file
- Configure options: highlight enabled, showHeader enabled
- Handle empty/undefined diff gracefully
- Style with border, rounded corners, overflow hidden
- Export as named export "DiffViewer"

Follow existing component patterns. Use 'use client' directive. Handle parsing errors gracefully.

Reference RESEARCH.md Pattern 2 for implementation details. Check @git-diff-view/react documentation for correct API usage.
</action>
  <verify>
File exists at apps/web/components/diff/diff-viewer.tsx with DiffViewer component exported. Component accepts diff prop. Parses Git diff and renders DiffView components. Handles empty diff gracefully.
</verify>
  <done>
DiffViewer component created and exports DiffViewer function. Component parses Git diff and displays changes with syntax highlighting.
</done>
</task>

<task type="auto">
  <name>Task 2: Integrate DiffViewer into session panel</name>
  <files>apps/web/components/session/session-panel.tsx</files>
  <action>
Enhance existing session-panel.tsx to display Git diff when available.

When session has commits (check session state or PR data):
- Fetch Git diff from API endpoint (may need to add GET /sessions/:id/diff endpoint if not exists)
- Display DiffViewer in collapsible section in session panel
- Show diff after commits are made, before or alongside PR panel
- Add "View Diff" button/link to toggle diff display

If API endpoint doesn't exist, add placeholder that shows "Diff available after commit" message. Integration should be non-blocking - session panel works without diff.

Preserve existing session-panel functionality (status indicator, PR panel, etc.). Add DiffViewer import and conditional rendering.

Reference existing session-panel.tsx structure and RESEARCH.md Pattern 2.
</action>
  <verify>
session-panel.tsx imports DiffViewer. Diff viewer displays when diff data available. Diff shows file changes with syntax highlighting. Session panel functionality preserved.
</verify>
  <done>
DiffViewer integrated into session panel. Git diffs display when available. Changes are visible with syntax highlighting.
</done>
</task>

</tasks>

<verification>
- DiffViewer component exists and renders Git diffs
- session-panel displays DiffViewer when diff available
- Diff parsing handles multiple files correctly
- Diff display shows additions/deletions with highlighting
</verification>

<success_criteria>
User can view Git diffs in session panel after agent commits. Diff shows file changes with syntax highlighting. Component handles edge cases (empty diff, parse errors).
</success_criteria>

<output>
After completion, create `.planning/phases/04-real-time-ui-visibility/04-02-SUMMARY.md`
</output>
