---
phase: 100-opencode-ui-parity
plan: 03
type: execute
wave: 2
depends_on: [100-02]
files_modified:
  - packages/ui/src/index.ts
  - packages/ui/src/progress.tsx (new)
  - packages/ui/src/scroll-area.tsx (new)
  - packages/ui/src/tabs.tsx (new)
  - apps/web/components/chat/tool-card.tsx (new)
  - apps/web/components/chat/activity-feed.tsx (new)
  - apps/web/components/chat/session-panel.tsx (refactor)
autonomous: true

must_haves:
  truths:
    - 'Tool calls display in beautiful collapsible cards with status colors'
    - 'Activity feed shows all tools with real-time status updates'
    - 'Session panel shows context, cost, todos, diffs in organized sections'
    - 'All components use existing shadcn/ui primitives for consistency'
  artifacts:
    - path: 'apps/web/components/chat/tool-card.tsx'
      provides: 'Beautiful tool display with input/output'
      exports: ['ToolCard']
    - path: 'apps/web/components/chat/activity-feed.tsx'
      provides: 'Live activity feed'
      exports: ['ActivityFeed']
    - path: 'apps/web/components/chat/session-panel.tsx'
      provides: 'Complete session sidebar replacement'
  key_links:
    - from: 'tool-card.tsx'
      to: '@ship/ui'
      via: 'imports Card, Collapsible, Badge'
---

<objective>
Create polished UI components for agent activity display using shadcn/ui

Purpose: The SSE stream provides rich data about tool calls, costs, todos, and file changes. We need beautiful components to display all this information like OpenCode does. Using our existing @ship/ui primitives ensures visual consistency.

Output: Tool cards, activity feed, and session panel that display ALL agent activity beautifully
</objective>

<execution_context>
@/Users/dylansteck/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
Existing @ship/ui components we can use:
- Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter
- Collapsible, CollapsibleTrigger, CollapsibleContent
- Badge (with variants: default, secondary, destructive, outline)
- Button
- Tooltip
- Separator
- Skeleton

Need to add:

- Progress (for context usage bar)
- ScrollArea (for long outputs)
- Tabs (for input/output toggle)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing shadcn/ui components</name>
  <files>packages/ui/src/progress.tsx, packages/ui/src/scroll-area.tsx, packages/ui/src/tabs.tsx, packages/ui/src/index.ts</files>
  <action>
Add these three components to @ship/ui:

**packages/ui/src/progress.tsx:**

```tsx
'use client'

import * as React from 'react'
import * as ProgressPrimitive from '@radix-ui/react-progress'
import { cn } from './utils'

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root> & {
    indicatorClassName?: string
  }
>(({ className, value, indicatorClassName, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn('relative h-2 w-full overflow-hidden rounded-full bg-primary/20', className)}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className={cn('h-full w-full flex-1 bg-primary transition-all', indicatorClassName)}
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }
```

**packages/ui/src/scroll-area.tsx:**

```tsx
'use client'

import * as React from 'react'
import * as ScrollAreaPrimitive from '@radix-ui/react-scroll-area'
import { cn } from './utils'

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root ref={ref} className={cn('relative overflow-hidden', className)} {...props}>
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">{children}</ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = 'vertical', ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      'flex touch-none select-none transition-colors',
      orientation === 'vertical' && 'h-full w-2.5 border-l border-l-transparent p-[1px]',
      orientation === 'horizontal' && 'h-2.5 flex-col border-t border-t-transparent p-[1px]',
      className,
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }
```

**packages/ui/src/tabs.tsx:**

```tsx
'use client'

import * as React from 'react'
import * as TabsPrimitive from '@radix-ui/react-tabs'
import { cn } from './utils'

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      'inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground',
      className,
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      'inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow',
      className,
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      'mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2',
      className,
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }
```

**Update packages/ui/src/index.ts:**

```typescript
// UI Components
export * from './button'
export * from './badge'
export * from './card'
export * from './collapsible'
export * from './dropdown-menu'
export * from './input'
export * from './progress'
export * from './scroll-area'
export * from './select'
export * from './separator'
export * from './sheet'
export * from './sidebar'
export * from './skeleton'
export * from './tabs'
export * from './textarea'
export * from './tooltip'

// Hooks
export * from './use-mobile'

// Utils
export * from './utils'
```

Install required Radix packages:

```bash
cd packages/ui && pnpm add @radix-ui/react-progress @radix-ui/react-scroll-area @radix-ui/react-tabs
```

  </action>
  <verify>
Run `pnpm build` in packages/ui to verify exports work correctly.
  </verify>
  <done>Progress, ScrollArea, and Tabs components added to @ship/ui</done>
</task>

<task type="auto">
  <name>Task 2: Create ToolCard component</name>
  <files>apps/web/components/chat/tool-card.tsx</files>
  <action>
Create a beautiful tool card using Card, Collapsible, Badge, ScrollArea:

```tsx
'use client'

import { useState } from 'react'
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
  Badge,
  Button,
  Tabs,
  TabsList,
  TabsTrigger,
  TabsContent,
  ScrollArea,
  Tooltip,
  cn,
} from '@ship/ui'
import { HugeiconsIcon } from '@hugeicons/react'
import {
  ArrowDown01Icon,
  ArrowUp01Icon,
  Copy01Icon,
  CheckmarkCircle01Icon,
  File01Icon,
  Search01Icon,
  TerminalIcon,
  Edit01Icon,
  Globe02Icon,
  TaskDone01Icon,
  HelpCircleIcon,
  CodeIcon,
  Clock01Icon,
} from '@hugeicons/core-free-icons'
import type { ToolState } from '@/lib/sse-types'

interface ToolCardProps {
  tool: string
  state: ToolState
  callID: string
  defaultOpen?: boolean
}

// Tool configuration with icons, colors, and labels
const TOOL_CONFIG: Record<
  string,
  {
    icon: typeof File01Icon
    color: string
    bgColor: string
    label: string
  }
> = {
  read: {
    icon: File01Icon,
    color: 'text-cyan-500',
    bgColor: 'bg-cyan-500/10',
    label: 'Read File',
  },
  glob: {
    icon: Search01Icon,
    color: 'text-amber-500',
    bgColor: 'bg-amber-500/10',
    label: 'Find Files',
  },
  grep: {
    icon: Search01Icon,
    color: 'text-amber-500',
    bgColor: 'bg-amber-500/10',
    label: 'Search Code',
  },
  bash: {
    icon: TerminalIcon,
    color: 'text-orange-500',
    bgColor: 'bg-orange-500/10',
    label: 'Terminal',
  },
  shell: {
    icon: TerminalIcon,
    color: 'text-orange-500',
    bgColor: 'bg-orange-500/10',
    label: 'Shell',
  },
  run: {
    icon: TerminalIcon,
    color: 'text-orange-500',
    bgColor: 'bg-orange-500/10',
    label: 'Run Command',
  },
  write: {
    icon: Edit01Icon,
    color: 'text-emerald-500',
    bgColor: 'bg-emerald-500/10',
    label: 'Write File',
  },
  edit: {
    icon: Edit01Icon,
    color: 'text-emerald-500',
    bgColor: 'bg-emerald-500/10',
    label: 'Edit File',
  },
  webfetch: {
    icon: Globe02Icon,
    color: 'text-blue-500',
    bgColor: 'bg-blue-500/10',
    label: 'Web Fetch',
  },
  websearch: {
    icon: Globe02Icon,
    color: 'text-blue-500',
    bgColor: 'bg-blue-500/10',
    label: 'Web Search',
  },
  codesearch: {
    icon: CodeIcon,
    color: 'text-violet-500',
    bgColor: 'bg-violet-500/10',
    label: 'Code Search',
  },
  task: {
    icon: TaskDone01Icon,
    color: 'text-purple-500',
    bgColor: 'bg-purple-500/10',
    label: 'Agent Task',
  },
  todo: {
    icon: TaskDone01Icon,
    color: 'text-purple-500',
    bgColor: 'bg-purple-500/10',
    label: 'Update Tasks',
  },
  question: {
    icon: HelpCircleIcon,
    color: 'text-sky-500',
    bgColor: 'bg-sky-500/10',
    label: 'Question',
  },
}

function getToolConfig(toolName: string) {
  const name = toolName.toLowerCase()
  for (const [key, config] of Object.entries(TOOL_CONFIG)) {
    if (name.includes(key)) return config
  }
  return {
    icon: CodeIcon,
    color: 'text-muted-foreground',
    bgColor: 'bg-muted/50',
    label: toolName,
  }
}

// Format input based on tool type
function formatInput(
  tool: string,
  input: Record<string, unknown>,
): {
  summary: string
  detail?: string
  code?: string
} {
  const name = tool.toLowerCase()

  if (name.includes('bash') || name.includes('shell') || name.includes('run')) {
    return {
      summary: (input.description as string) || 'Command',
      code: `$ ${input.command as string}`,
    }
  }

  if (name.includes('read')) {
    const filePath = (input.filePath || input.path) as string
    const fileName = filePath?.split('/').pop() || filePath
    return {
      summary: 'Reading file',
      detail: fileName,
      code: filePath,
    }
  }

  if (name.includes('glob')) {
    return {
      summary: 'Finding files',
      detail: `Pattern: ${input.pattern as string}`,
      code: input.path ? `in ${input.path}` : undefined,
    }
  }

  if (name.includes('grep')) {
    return {
      summary: 'Searching for',
      detail: `"${input.pattern as string}"`,
      code: input.include ? `in ${input.include}` : undefined,
    }
  }

  if (name.includes('write')) {
    const filePath = (input.filePath || input.path) as string
    const fileName = filePath?.split('/').pop() || filePath
    return {
      summary: 'Writing file',
      detail: fileName,
      code: filePath,
    }
  }

  if (name.includes('edit')) {
    const filePath = (input.filePath || input.path) as string
    const fileName = filePath?.split('/').pop() || filePath
    return {
      summary: 'Editing file',
      detail: fileName,
      code: filePath,
    }
  }

  if (name.includes('task') || name.includes('agent')) {
    const desc = (input.description || input.prompt) as string
    return {
      summary: 'Delegating task',
      detail: desc?.slice(0, 60) + (desc?.length > 60 ? '...' : ''),
    }
  }

  return {
    summary: 'Input',
    code: JSON.stringify(input, null, 2),
  }
}

// Status badge variants
const STATUS_CONFIG = {
  pending: {
    variant: 'outline' as const,
    label: 'Pending',
    dotColor: 'bg-muted-foreground/50',
  },
  running: {
    variant: 'default' as const,
    label: 'Running',
    dotColor: 'bg-blue-500',
  },
  completed: {
    variant: 'secondary' as const,
    label: 'Done',
    dotColor: 'bg-emerald-500',
  },
  error: {
    variant: 'destructive' as const,
    label: 'Error',
    dotColor: 'bg-red-500',
  },
}

export function ToolCard({ tool, state, callID, defaultOpen = false }: ToolCardProps) {
  const [open, setOpen] = useState(defaultOpen || state.status === 'running')
  const [copied, setCopied] = useState(false)
  const [activeTab, setActiveTab] = useState<'input' | 'output'>('input')

  const config = getToolConfig(tool)
  const Icon = config.icon
  const inputInfo = formatInput(tool, state.input)
  const statusConfig = STATUS_CONFIG[state.status]

  const hasOutput = state.output && state.output.length > 0
  const hasInput = state.input && Object.keys(state.input).length > 0
  const hasContent = hasInput || hasOutput

  // Calculate duration if we have timing
  const duration = state.time?.start && state.time?.end ? Math.round((state.time.end - state.time.start) / 1000) : null

  const handleCopy = async (text: string) => {
    await navigator.clipboard.writeText(text)
    setCopied(true)
    setTimeout(() => setCopied(false), 2000)
  }

  return (
    <Collapsible open={open} onOpenChange={setOpen}>
      <Card
        size="sm"
        className={cn(
          'transition-all duration-200',
          state.status === 'running' && 'ring-2 ring-blue-500/30 shadow-blue-500/10 shadow-lg',
          state.status === 'error' && 'ring-2 ring-red-500/30',
        )}
      >
        <CollapsibleTrigger asChild>
          <CardHeader className="cursor-pointer hover:bg-muted/30 transition-colors py-2.5">
            <div className="flex items-center gap-3">
              {/* Status indicator + Icon */}
              <div className={cn('relative p-2 rounded-lg', config.bgColor)}>
                {/* Animated ping for running */}
                {state.status === 'running' && (
                  <span className="absolute inset-0 rounded-lg bg-blue-500/20 animate-ping" />
                )}
                <HugeiconsIcon icon={Icon} strokeWidth={2} className={cn('size-4 relative', config.color)} />
              </div>

              {/* Tool info */}
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2">
                  <CardTitle className="text-sm">{config.label}</CardTitle>
                  {inputInfo.detail && (
                    <span className="text-xs text-muted-foreground truncate max-w-[180px]">{inputInfo.detail}</span>
                  )}
                </div>
                {state.title && state.title !== inputInfo.detail && (
                  <p className="text-xs text-muted-foreground truncate mt-0.5">{state.title}</p>
                )}
              </div>

              {/* Right side: status badge + duration + expand */}
              <div className="flex items-center gap-2">
                {duration !== null && (
                  <Tooltip content={`Took ${duration}s`}>
                    <span className="text-xs text-muted-foreground flex items-center gap-1">
                      <HugeiconsIcon icon={Clock01Icon} strokeWidth={2} className="size-3" />
                      {duration}s
                    </span>
                  </Tooltip>
                )}

                <Badge variant={statusConfig.variant}>
                  <span
                    className={cn(
                      'w-1.5 h-1.5 rounded-full mr-1',
                      statusConfig.dotColor,
                      state.status === 'running' && 'animate-pulse',
                    )}
                  />
                  {statusConfig.label}
                </Badge>

                {hasContent && (
                  <HugeiconsIcon
                    icon={open ? ArrowUp01Icon : ArrowDown01Icon}
                    strokeWidth={2}
                    className="size-4 text-muted-foreground"
                  />
                )}
              </div>
            </div>
          </CardHeader>
        </CollapsibleTrigger>

        <CollapsibleContent>
          {hasContent && (
            <CardContent className="pt-0 pb-3">
              <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'input' | 'output')}>
                <div className="flex items-center justify-between mb-2">
                  <TabsList className="h-7">
                    <TabsTrigger value="input" className="text-xs px-2 py-1">
                      Input
                    </TabsTrigger>
                    <TabsTrigger value="output" className="text-xs px-2 py-1" disabled={!hasOutput}>
                      Output
                      {hasOutput && (
                        <span className="ml-1 text-[10px] text-muted-foreground">
                          ({(state.output?.length || 0).toLocaleString()} chars)
                        </span>
                      )}
                    </TabsTrigger>
                  </TabsList>

                  <Button
                    variant="ghost"
                    size="sm"
                    className="h-7 w-7 p-0"
                    onClick={() =>
                      handleCopy(activeTab === 'input' ? JSON.stringify(state.input, null, 2) : state.output || '')
                    }
                  >
                    <HugeiconsIcon
                      icon={copied ? CheckmarkCircle01Icon : Copy01Icon}
                      strokeWidth={2}
                      className={cn('size-3.5', copied && 'text-emerald-500')}
                    />
                  </Button>
                </div>

                <TabsContent value="input" className="mt-0">
                  <ScrollArea className="max-h-[200px]">
                    <pre className="text-xs font-mono bg-muted/50 rounded-md p-3 whitespace-pre-wrap break-all">
                      {inputInfo.code || JSON.stringify(state.input, null, 2)}
                    </pre>
                  </ScrollArea>
                </TabsContent>

                <TabsContent value="output" className="mt-0">
                  {hasOutput && (
                    <ScrollArea className="max-h-[300px]">
                      <pre
                        className={cn(
                          'text-xs font-mono rounded-md p-3 whitespace-pre-wrap break-all',
                          state.status === 'error' ? 'bg-red-500/10 text-red-600 dark:text-red-400' : 'bg-muted/50',
                        )}
                      >
                        {state.output}
                      </pre>
                    </ScrollArea>
                  )}
                </TabsContent>
              </Tabs>
            </CardContent>
          )}
        </CollapsibleContent>
      </Card>
    </Collapsible>
  )
}
```

  </action>
  <verify>
Import and render a test ToolCard with mock data to verify styling.
  </verify>
  <done>ToolCard component created with shadcn/ui Card, Collapsible, Badge, Tabs, ScrollArea</done>
</task>

<task type="auto">
  <name>Task 3: Create ActivityFeed component</name>
  <files>apps/web/components/chat/activity-feed.tsx</files>
  <action>
Create the activity feed that shows all agent activity:

```tsx
'use client'

import { useState, useEffect } from 'react'
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
  Badge,
  Button,
  Progress,
  Separator,
  cn,
} from '@ship/ui'
import { HugeiconsIcon } from '@hugeicons/react'
import { ArrowDown01Icon, ArrowUp01Icon, DollarSquareIcon, Cpu01Icon } from '@hugeicons/core-free-icons'
import { ToolCard } from './tool-card'
import type { ToolPart, StepFinishPart } from '@/lib/sse-types'

interface ActivityFeedProps {
  isStreaming: boolean
  tools: ToolPart[]
  statusLabel?: string
  statusIcon?: string
  stepCosts: Array<{ cost: number; tokens: StepFinishPart['tokens'] }>
  reasoning?: string
  expanded?: boolean
  onToggle?: () => void
}

function formatCost(cost: number): string {
  if (cost === 0) return 'Free'
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 4,
    maximumFractionDigits: 4,
  }).format(cost)
}

function formatDuration(seconds: number): string {
  if (seconds < 60) return `${seconds}s`
  const mins = Math.floor(seconds / 60)
  const secs = seconds % 60
  return `${mins}m ${secs}s`
}

export function ActivityFeed({
  isStreaming,
  tools,
  statusLabel = 'Processing...',
  statusIcon = 'âš¡',
  stepCosts,
  reasoning,
  expanded: controlledExpanded,
  onToggle,
}: ActivityFeedProps) {
  const [internalExpanded, setInternalExpanded] = useState(true)
  const [elapsedTime, setElapsedTime] = useState(0)
  const [startTime] = useState(() => Date.now())

  const expanded = controlledExpanded ?? internalExpanded
  const handleToggle = onToggle ?? (() => setInternalExpanded(!internalExpanded))

  // Track elapsed time while streaming
  useEffect(() => {
    if (!isStreaming) return

    const interval = setInterval(() => {
      setElapsedTime(Math.floor((Date.now() - startTime) / 1000))
    }, 1000)

    return () => clearInterval(interval)
  }, [isStreaming, startTime])

  // Calculate totals
  const totalCost = stepCosts.reduce((sum, s) => sum + s.cost, 0)
  const totalTokens = stepCosts.reduce((sum, s) => sum + s.tokens.input + s.tokens.output + s.tokens.reasoning, 0)

  // Find active and completed tools
  const runningTools = tools.filter((t) => t.state.status === 'running')
  const completedTools = tools.filter((t) => t.state.status === 'completed')
  const errorTools = tools.filter((t) => t.state.status === 'error')

  if (!isStreaming && tools.length === 0) {
    return null
  }

  return (
    <Card className="w-full max-w-[720px]">
      <Collapsible open={expanded} onOpenChange={handleToggle}>
        <CollapsibleTrigger asChild>
          <CardHeader className="cursor-pointer hover:bg-muted/30 transition-colors py-3">
            <div className="flex items-center gap-3">
              {/* Animated status indicator */}
              <div className="relative">
                <span className={cn('flex h-3 w-3 rounded-full', isStreaming ? 'bg-blue-500' : 'bg-emerald-500')}>
                  {isStreaming && (
                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75" />
                  )}
                </span>
              </div>

              {/* Status label */}
              <div className="flex-1 min-w-0">
                <CardTitle className="text-sm flex items-center gap-2">
                  <span>{statusIcon}</span>
                  <span className="truncate">{statusLabel}</span>
                </CardTitle>
              </div>

              {/* Stats badges */}
              <div className="flex items-center gap-2">
                {/* Tool counts */}
                {tools.length > 0 && (
                  <div className="flex items-center gap-1.5 text-xs text-muted-foreground">
                    <span>
                      {completedTools.length}/{tools.length} tools
                    </span>
                  </div>
                )}

                {/* Duration */}
                {(isStreaming || elapsedTime > 0) && (
                  <Badge variant="outline" className="text-xs">
                    {formatDuration(elapsedTime)}
                  </Badge>
                )}

                {/* Cost badge */}
                {totalCost > 0 && (
                  <Badge variant="secondary" className="text-xs">
                    <HugeiconsIcon icon={DollarSquareIcon} strokeWidth={2} className="size-3 mr-1" />
                    {formatCost(totalCost)}
                  </Badge>
                )}

                {/* Expand arrow */}
                <HugeiconsIcon
                  icon={expanded ? ArrowUp01Icon : ArrowDown01Icon}
                  strokeWidth={2}
                  className="size-4 text-muted-foreground"
                />
              </div>
            </div>
          </CardHeader>
        </CollapsibleTrigger>

        <CollapsibleContent>
          <CardContent className="pt-0 space-y-4">
            {/* Token/Cost summary bar */}
            {stepCosts.length > 0 && (
              <div className="flex items-center gap-4 p-3 bg-muted/30 rounded-lg">
                <div className="flex-1">
                  <div className="flex items-center justify-between text-xs mb-1">
                    <span className="text-muted-foreground">Tokens used</span>
                    <span className="font-mono">{totalTokens.toLocaleString()}</span>
                  </div>
                  <Progress
                    value={Math.min((totalTokens / 200000) * 100, 100)}
                    className="h-1.5"
                    indicatorClassName={totalTokens > 150000 ? 'bg-amber-500' : undefined}
                  />
                  <div className="flex justify-between text-[10px] text-muted-foreground mt-0.5">
                    <span>0</span>
                    <span>200K context</span>
                  </div>
                </div>

                <Separator orientation="vertical" className="h-10" />

                <div className="text-right">
                  <div className="text-xs text-muted-foreground">Total cost</div>
                  <div className="font-semibold">{formatCost(totalCost)}</div>
                </div>
              </div>
            )}

            {/* Reasoning section */}
            {reasoning && (
              <div className="p-3 bg-violet-500/5 rounded-lg border border-violet-500/20">
                <div className="flex items-center gap-2 text-xs text-violet-600 dark:text-violet-400 mb-2">
                  <span>ðŸ’­</span>
                  <span className="font-medium">Reasoning</span>
                </div>
                <p className="text-sm text-foreground/80 leading-relaxed whitespace-pre-wrap">{reasoning}</p>
              </div>
            )}

            {/* Tool list */}
            <div className="space-y-2">
              {tools.length === 0 && isStreaming && (
                <div className="flex items-center justify-center py-4 text-sm text-muted-foreground">
                  <span className="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse mr-2" />
                  Initializing agent...
                </div>
              )}

              {/* Show running tools first */}
              {runningTools.map((tool) => (
                <ToolCard
                  key={tool.callID}
                  tool={tool.tool}
                  state={tool.state}
                  callID={tool.callID}
                  defaultOpen={true}
                />
              ))}

              {/* Then completed */}
              {completedTools.map((tool) => (
                <ToolCard
                  key={tool.callID}
                  tool={tool.tool}
                  state={tool.state}
                  callID={tool.callID}
                  defaultOpen={false}
                />
              ))}

              {/* Errors at bottom */}
              {errorTools.map((tool) => (
                <ToolCard
                  key={tool.callID}
                  tool={tool.tool}
                  state={tool.state}
                  callID={tool.callID}
                  defaultOpen={true}
                />
              ))}
            </div>
          </CardContent>
        </CollapsibleContent>
      </Collapsible>
    </Card>
  )
}
```

  </action>
  <verify>
Import and test ActivityFeed with mock tools data.
  </verify>
  <done>ActivityFeed shows tools, costs, reasoning with beautiful layout</done>
</task>

<task type="auto">
  <name>Task 4: Create SessionPanel component (replaces sidebar)</name>
  <files>apps/web/components/chat/session-panel.tsx</files>
  <action>
Create a comprehensive session panel that replaces the existing right sidebar:

```tsx
'use client'

import { Card, CardContent, CardHeader, CardTitle, Badge, Progress, Separator, ScrollArea, Tooltip, cn } from '@ship/ui'
import { HugeiconsIcon } from '@hugeicons/react'
import {
  GithubIcon,
  Cpu01Icon,
  File01Icon,
  TaskDone01Icon,
  GitBranch01Icon,
  DollarSquareIcon,
  Clock01Icon,
  Add01Icon,
  Remove01Icon,
} from '@hugeicons/core-free-icons'

interface Todo {
  id: string
  content: string
  status: 'pending' | 'in_progress' | 'completed' | 'cancelled'
  priority: 'high' | 'medium' | 'low'
}

interface FileDiff {
  filename: string
  additions: number
  deletions: number
}

interface SessionPanelProps {
  // Repository info
  repoOwner?: string
  repoName?: string
  branch?: string

  // Model info
  modelId?: string
  modelName?: string
  provider?: string

  // Mode
  mode: 'build' | 'plan'

  // Context usage
  contextTokens?: number
  contextLimit?: number

  // Cost tracking
  totalCost?: number
  stepCount?: number

  // Status
  isStreaming: boolean
  statusLabel?: string
  elapsedTime?: number

  // Todos from agent
  todos?: Todo[]

  // File changes
  fileDiffs?: FileDiff[]
}

function formatCost(cost: number): string {
  if (cost === 0) return 'Free'
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 2,
  }).format(cost)
}

function formatDuration(seconds: number): string {
  if (seconds < 60) return `${seconds}s`
  const mins = Math.floor(seconds / 60)
  const secs = seconds % 60
  return `${mins}m ${secs}s`
}

const PRIORITY_COLORS = {
  high: 'text-red-500',
  medium: 'text-amber-500',
  low: 'text-muted-foreground',
}

export function SessionPanel({
  repoOwner,
  repoName,
  branch,
  modelId,
  modelName,
  provider,
  mode,
  contextTokens = 0,
  contextLimit = 200000,
  totalCost = 0,
  stepCount = 0,
  isStreaming,
  statusLabel,
  elapsedTime = 0,
  todos = [],
  fileDiffs = [],
}: SessionPanelProps) {
  const contextPercentage = Math.round((contextTokens / contextLimit) * 100)
  const completedTodos = todos.filter((t) => t.status === 'completed')
  const totalAdditions = fileDiffs.reduce((sum, f) => sum + f.additions, 0)
  const totalDeletions = fileDiffs.reduce((sum, f) => sum + f.deletions, 0)

  return (
    <ScrollArea className="h-full">
      <div className="w-60 p-4 space-y-4">
        {/* Status card - only when streaming */}
        {isStreaming && (
          <Card size="sm" className="bg-blue-500/5 border-blue-500/20">
            <CardContent className="py-3">
              <div className="flex items-center gap-2">
                <span className="relative flex h-2 w-2">
                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75" />
                  <span className="relative inline-flex rounded-full h-2 w-2 bg-blue-500" />
                </span>
                <span className="text-xs font-medium text-blue-600 dark:text-blue-400 truncate flex-1">
                  {statusLabel || 'Processing...'}
                </span>
                {elapsedTime > 0 && (
                  <span className="text-[10px] text-muted-foreground">{formatDuration(elapsedTime)}</span>
                )}
              </div>
            </CardContent>
          </Card>
        )}

        {/* Repository section */}
        {(repoOwner || repoName) && (
          <div className="space-y-2">
            <h3 className="text-[10px] font-semibold text-muted-foreground uppercase tracking-wider">Repository</h3>
            <Card size="sm">
              <CardContent className="py-2.5">
                <div className="flex items-center gap-2">
                  <div className="p-1.5 rounded bg-muted">
                    <HugeiconsIcon icon={GithubIcon} strokeWidth={2} className="size-3.5" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm font-medium truncate">{repoName}</p>
                    <p className="text-[10px] text-muted-foreground">{repoOwner}</p>
                  </div>
                </div>
                {branch && (
                  <div className="flex items-center gap-1.5 mt-2 text-xs text-muted-foreground">
                    <HugeiconsIcon icon={GitBranch01Icon} strokeWidth={2} className="size-3" />
                    <span className="truncate font-mono">{branch}</span>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        )}

        {/* Model & Mode section */}
        <div className="space-y-2">
          <h3 className="text-[10px] font-semibold text-muted-foreground uppercase tracking-wider">Configuration</h3>
          <Card size="sm">
            <CardContent className="py-2.5 space-y-3">
              {/* Model */}
              <div className="flex items-center gap-2">
                <div className="p-1.5 rounded bg-muted">
                  <HugeiconsIcon icon={Cpu01Icon} strokeWidth={2} className="size-3.5" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-sm font-medium truncate">{modelName || modelId || 'Default'}</p>
                  {provider && <p className="text-[10px] text-muted-foreground">{provider}</p>}
                </div>
              </div>

              <Separator />

              {/* Mode */}
              <div className="flex items-center justify-between">
                <span className="text-xs text-muted-foreground">Mode</span>
                <Badge variant={mode === 'build' ? 'default' : 'secondary'}>
                  <span
                    className={cn(
                      'w-1.5 h-1.5 rounded-full mr-1.5',
                      mode === 'build' ? 'bg-emerald-400' : 'bg-blue-400',
                    )}
                  />
                  {mode}
                </Badge>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Context & Cost section */}
        <div className="space-y-2">
          <h3 className="text-[10px] font-semibold text-muted-foreground uppercase tracking-wider">Usage</h3>
          <Card size="sm">
            <CardContent className="py-2.5 space-y-3">
              {/* Context tokens */}
              <div>
                <div className="flex items-center justify-between text-xs mb-1.5">
                  <span className="text-muted-foreground">Context</span>
                  <span className="font-mono">
                    {contextTokens.toLocaleString()} / {(contextLimit / 1000).toFixed(0)}K
                  </span>
                </div>
                <Progress
                  value={contextPercentage}
                  className="h-1.5"
                  indicatorClassName={cn(
                    contextPercentage > 80 && 'bg-amber-500',
                    contextPercentage > 90 && 'bg-red-500',
                  )}
                />
                <p className="text-[10px] text-muted-foreground mt-1 text-right">{contextPercentage}% used</p>
              </div>

              <Separator />

              {/* Cost */}
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-1.5 text-xs text-muted-foreground">
                  <HugeiconsIcon icon={DollarSquareIcon} strokeWidth={2} className="size-3.5" />
                  <span>Cost</span>
                </div>
                <span className="font-semibold text-sm">{formatCost(totalCost)}</span>
              </div>

              {stepCount > 0 && (
                <div className="flex items-center justify-between text-xs">
                  <span className="text-muted-foreground">Steps</span>
                  <span>{stepCount}</span>
                </div>
              )}
            </CardContent>
          </Card>
        </div>

        {/* Todos section */}
        {todos.length > 0 && (
          <div className="space-y-2">
            <div className="flex items-center justify-between">
              <h3 className="text-[10px] font-semibold text-muted-foreground uppercase tracking-wider">Tasks</h3>
              <span className="text-[10px] text-muted-foreground">
                {completedTodos.length}/{todos.length}
              </span>
            </div>
            <Card size="sm">
              <CardContent className="py-2 max-h-[200px] overflow-y-auto">
                <div className="space-y-1.5">
                  {todos.slice(0, 8).map((todo) => (
                    <div key={todo.id} className="flex items-start gap-2 text-xs">
                      <HugeiconsIcon
                        icon={TaskDone01Icon}
                        strokeWidth={2}
                        className={cn(
                          'size-3.5 mt-0.5 flex-shrink-0',
                          todo.status === 'completed' && 'text-emerald-500',
                          todo.status === 'in_progress' && 'text-blue-500',
                          todo.status === 'pending' && PRIORITY_COLORS[todo.priority],
                          todo.status === 'cancelled' && 'text-muted-foreground/50',
                        )}
                      />
                      <span
                        className={cn(
                          'truncate',
                          todo.status === 'completed' && 'text-muted-foreground line-through',
                          todo.status === 'cancelled' && 'text-muted-foreground/50 line-through',
                        )}
                      >
                        {todo.content}
                      </span>
                    </div>
                  ))}
                  {todos.length > 8 && (
                    <p className="text-[10px] text-muted-foreground ml-5">+{todos.length - 8} more tasks</p>
                  )}
                </div>
              </CardContent>
            </Card>
          </div>
        )}

        {/* File changes section */}
        {fileDiffs.length > 0 && (
          <div className="space-y-2">
            <div className="flex items-center justify-between">
              <h3 className="text-[10px] font-semibold text-muted-foreground uppercase tracking-wider">Changes</h3>
              <div className="flex items-center gap-2 text-[10px]">
                <span className="text-emerald-500 flex items-center">
                  <HugeiconsIcon icon={Add01Icon} strokeWidth={2} className="size-2.5 mr-0.5" />
                  {totalAdditions}
                </span>
                <span className="text-red-500 flex items-center">
                  <HugeiconsIcon icon={Remove01Icon} strokeWidth={2} className="size-2.5 mr-0.5" />
                  {totalDeletions}
                </span>
              </div>
            </div>
            <Card size="sm">
              <CardContent className="py-2 max-h-[180px] overflow-y-auto">
                <div className="space-y-1">
                  {fileDiffs.slice(0, 10).map((diff, i) => (
                    <div key={i} className="flex items-center gap-2 text-xs">
                      <HugeiconsIcon
                        icon={File01Icon}
                        strokeWidth={2}
                        className="size-3 text-muted-foreground flex-shrink-0"
                      />
                      <Tooltip content={diff.filename}>
                        <span className="truncate flex-1 font-mono">{diff.filename.split('/').pop()}</span>
                      </Tooltip>
                      <span className="flex gap-1.5 flex-shrink-0 text-[10px]">
                        {diff.additions > 0 && <span className="text-emerald-500">+{diff.additions}</span>}
                        {diff.deletions > 0 && <span className="text-red-500">-{diff.deletions}</span>}
                      </span>
                    </div>
                  ))}
                  {fileDiffs.length > 10 && (
                    <p className="text-[10px] text-muted-foreground">+{fileDiffs.length - 10} more files</p>
                  )}
                </div>
              </CardContent>
            </Card>
          </div>
        )}
      </div>
    </ScrollArea>
  )
}
```

  </action>
  <verify>
Render SessionPanel with various prop combinations to verify all sections display correctly.
  </verify>
  <done>SessionPanel shows repo, model, context usage, cost, todos, and file diffs</done>
</task>

</tasks>

<verification>
1. All new shadcn/ui components compile and export correctly
2. ToolCard shows tool details with proper styling
3. ActivityFeed shows tools list with cost summary
4. SessionPanel shows all session metadata sections
5. All components follow @ship/ui design patterns
</verification>

<success_criteria>

- Progress, ScrollArea, Tabs added to @ship/ui
- ToolCard renders with Card + Collapsible + Tabs + Badge
- ActivityFeed shows tools grouped by status
- SessionPanel shows all metadata: repo, model, context, cost, todos, diffs
- All components look polished and consistent
- No TypeScript errors
  </success_criteria>

<output>
After completion, create `.planning/phases/100-opencode-ui-parity/100-03-SUMMARY.md`
</output>
