---
phase: 05-external-integrations
plan: 05
type: execute
wave: 2
depends_on: []
files_modified:
  - apps/api/src/lib/mcp/vercel.ts
  - apps/api/src/routes/mcp.ts
  - apps/api/src/lib/agent-executor.ts
autonomous: true

must_haves:
  truths:
    - "User can access Vercel deployment tools via MCP in chat"
    - "Vercel MCP server exposes deployment tools"
    - "Agent can deploy previews and trigger builds via MCP"
  artifacts:
    - path: "apps/api/src/lib/mcp/vercel.ts"
      provides: "Vercel MCP server implementation"
      min_lines: 150
      exports: ["createVercelMCPServer"]
    - path: "apps/api/src/routes/mcp.ts"
      provides: "MCP server endpoint"
      min_lines: 50
      exports: ["POST /mcp/vercel"]
    - path: "apps/api/src/lib/agent-executor.ts"
      provides: "Agent executor with MCP tool registration"
      contains: "registerMCPServer"
  key_links:
    - from: "apps/api/src/lib/agent-executor.ts"
      to: "apps/api/src/lib/mcp/vercel.ts"
      via: "import createVercelMCPServer"
      pattern: "createVercelMCPServer"
---

<objective>
Create Vercel MCP server that exposes deployment tools for agent access in chat.

Purpose: Enable agent to deploy previews, trigger builds, and access deployment logs via MCP protocol, providing deployment capabilities directly in chat interface.
Output: Vercel MCP server with deployment tools and MCP endpoint
</objective>

<execution_context>
@/Users/dylansteck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylansteck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-external-integrations/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vercel MCP server</name>
  <files>apps/api/src/lib/mcp/vercel.ts</files>
  <action>
Create Vercel MCP server using @modelcontextprotocol/sdk.

MCP server should expose tools:
- vercel_deploy_preview(branch, projectId) - Deploy preview branch
- vercel_deploy_production(branch, projectId) - Deploy to production
- vercel_get_deployment(deploymentId) - Get deployment status and logs
- vercel_list_deployments(projectId) - List recent deployments

Tool implementations:
- Use @vercel/sdk for Vercel API calls
- Get Vercel token from user's accounts table (provider='vercel')
- Handle authentication errors gracefully
- Return structured tool results

Follow RESEARCH.md Pattern 2 for MCP server setup. Use MCP SDK server framework.
</action>
  <verify>
Vercel MCP server exists with deployment tools. Tools use Vercel SDK correctly. Authentication handled properly.
</verify>
  <done>
Vercel MCP server created. Deployment tools exposed via MCP protocol.
</done>
</task>

<task type="auto">
  <name>Task 2: Create MCP endpoint</name>
  <files>apps/api/src/routes/mcp.ts</files>
  <action>
Create MCP server endpoint for agent access.

Route:
- POST /mcp/vercel - MCP protocol endpoint
- Handles MCP requests (tools/list, tools/call, etc.)
- Routes to Vercel MCP server
- Returns MCP protocol responses

MCP protocol:
- Follow MCP specification for request/response format
- Handle tool listing requests
- Handle tool call requests
- Return tool results in MCP format

Follow RESEARCH.md Pattern 2 for MCP endpoint implementation. Use MCP SDK for protocol handling.
</action>
  <verify>
MCP endpoint exists. Handles MCP protocol requests. Routes to Vercel MCP server. Returns MCP responses.
</verify>
  <done>
MCP endpoint created. Agent can access Vercel tools via MCP protocol.
</done>
</task>

<task type="auto">
  <name>Task 3: Register MCP server with agent executor</name>
  <files>apps/api/src/lib/agent-executor.ts</files>
  <action>
Register Vercel MCP server with OpenCode agent executor.

Registration:
- On agent initialization, register Vercel MCP server
- Provide MCP server URL to OpenCode SDK
- Enable agent to call Vercel tools via MCP

Check user preferences for Vercel connector enabled:
- Query user_preferences for 'connector.vercel.enabled'
- Only register if enabled
- Handle missing Vercel account gracefully

Preserve existing agent executor functionality. Add MCP registration as optional feature.
</action>
  <verify>
Vercel MCP server registered with agent executor. Agent can call Vercel tools. Registration respects connector enable/disable setting.
</verify>
  <done>
MCP server registered with agent executor. Agent can deploy via Vercel tools in chat.
</done>
</task>

</tasks>

<verification>
- Vercel MCP server exposes deployment tools
- MCP endpoint handles protocol requests
- Agent can call Vercel tools via MCP
- Deployment tools work correctly
</verification>

<success_criteria>
User can access Vercel deployment tools via MCP in chat. Agent can deploy previews and trigger builds through MCP tools.
</success_criteria>

<output>
After completion, create `.planning/phases/05-external-integrations/05-05-SUMMARY.md`
</output>
