---
phase: 05-external-integrations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/api/src/lib/linear.ts
  - apps/api/src/routes/linear.ts
  - apps/web/app/api/auth/linear/route.ts
  - apps/web/app/api/auth/linear/callback/route.ts
autonomous: true

must_haves:
  truths:
    - "User can connect Linear account via OAuth"
    - "Linear access token stored securely in accounts table"
    - "Linear API client available for issue operations"
  artifacts:
    - path: "apps/api/src/lib/linear.ts"
      provides: "Linear GraphQL API client wrapper"
      min_lines: 100
      exports: ["LinearClient", "createLinearClient"]
    - path: "apps/api/src/routes/linear.ts"
      provides: "Linear API routes for issue operations"
      min_lines: 80
      exports: ["GET /linear/issues", "POST /linear/issues"]
    - path: "apps/web/app/api/auth/linear/route.ts"
      provides: "Linear OAuth initiation endpoint"
      min_lines: 30
    - path: "apps/web/app/api/auth/linear/callback/route.ts"
      provides: "Linear OAuth callback handler"
      min_lines: 50
  key_links:
    - from: "apps/api/src/routes/linear.ts"
      to: "apps/api/src/lib/linear.ts"
      via: "import LinearClient"
      pattern: "import.*linear"
---

<objective>
Implement Linear OAuth flow and API client for issue management integration.

Purpose: Enable users to connect their Linear account and provide API access for syncing issues and updating status.
Output: Linear OAuth flow, API client wrapper, and basic API routes
</objective>

<execution_context>
@/Users/dylansteck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylansteck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-external-integrations/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Linear API client wrapper</name>
  <files>apps/api/src/lib/linear.ts</files>
  <action>
Create Linear API client wrapper using @linear/sdk or graphql-request.

Client should:
- Accept Linear access token
- Provide methods: getIssues(), getIssue(id), updateIssue(id, data), createIssue(data)
- Handle GraphQL queries/mutations
- Implement rate limiting with exponential backoff
- Handle authentication errors and token refresh

Follow existing API client patterns from apps/api/src/lib (e.g., github.ts if exists). Use TypeScript interfaces for issue types.

Reference RESEARCH.md Pattern 1 for Linear GraphQL API usage.
</action>
  <verify>
File exists at apps/api/src/lib/linear.ts with LinearClient class exported. Client provides methods for issue operations. Handles authentication and rate limiting.
</verify>
  <done>
Linear API client created. Provides methods for issue CRUD operations with proper error handling and rate limiting.
</done>
</task>

<task type="auto">
  <name>Task 2: Implement Linear OAuth flow</name>
  <files>apps/web/app/api/auth/linear/route.ts, apps/web/app/api/auth/linear/callback/route.ts</files>
  <action>
Implement Linear OAuth flow following GitHub OAuth pattern.

OAuth initiation (route.ts):
- Redirect to Linear OAuth authorization URL
- Store state in signed cookie for CSRF protection
- Use Linear OAuth app credentials from environment

OAuth callback (callback/route.ts):
- Exchange authorization code for access token
- Store Linear account in accounts table (provider='linear')
- Encrypt access token before storage (use existing encryption utilities)
- Redirect to settings page or dashboard

Follow existing GitHub OAuth pattern from apps/web/app/api/auth/github/. Use Arctic library if compatible, or implement manually.

Reference existing GitHub OAuth implementation for patterns.
</action>
  <verify>
Linear OAuth routes exist. Authorization redirect works. Callback exchanges code for token and stores account. Token encrypted before storage.
</verify>
  <done>
Linear OAuth flow implemented. Users can connect Linear account and token stored securely.
</done>
</task>

<task type="auto">
  <name>Task 3: Create Linear API routes</name>
  <files>apps/api/src/routes/linear.ts</files>
  <action>
Create Linear API routes for issue operations.

Routes:
- GET /linear/issues - List user's assigned issues (requires Linear account)
- GET /linear/issues/:id - Get specific issue details
- POST /linear/issues - Create new issue
- PATCH /linear/issues/:id - Update issue (status, description, etc.)

All routes:
- Verify user has Linear account connected
- Get Linear access token from accounts table
- Use LinearClient for API calls
- Return DTOs (not raw API responses)
- Handle errors gracefully

Follow existing route patterns from apps/api/src/routes/. Use Hono router.
</action>
  <verify>
Linear routes exist and handle issue operations. Routes verify Linear account connection. API calls use LinearClient. Errors handled gracefully.
</verify>
  <done>
Linear API routes created. Issue operations available via API with proper authentication.
</done>
</task>

</tasks>

<verification>
- Linear OAuth flow works end-to-end
- Access token stored securely in accounts table
- LinearClient provides issue CRUD operations
- API routes handle authentication and errors correctly
</verification>

<success_criteria>
User can connect Linear account via OAuth. Linear API client available for issue operations. API routes provide issue management functionality.
</success_criteria>

<output>
After completion, create `.planning/phases/05-external-integrations/05-01-SUMMARY.md`
</output>
