---
phase: 01-foundation-authentication
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - apps/web/app/(auth)/login/page.tsx
  - apps/web/app/(auth)/layout.tsx
  - apps/web/app/(app)/dashboard/page.tsx
  - apps/web/app/(app)/layout.tsx
  - apps/web/app/(app)/onboarding/page.tsx
  - apps/web/app/layout.tsx
  - apps/web/app/page.tsx
  - apps/web/components/providers/theme-provider.tsx
  - apps/web/components/theme-toggle.tsx
  - apps/web/components/ui/button.tsx
  - packages/ui/src/button.tsx
autonomous: true

must_haves:
  truths:
    - "Login page displays Ship logo and 'Sign in with GitHub' button"
    - "Clicking 'Sign in with GitHub' initiates OAuth flow"
    - "After successful auth, new users see onboarding welcome"
    - "After onboarding or for returning users, dashboard loads"
    - "Theme toggle switches between light and dark mode"
    - "Light mode is the default theme"
  artifacts:
    - path: "apps/web/app/(auth)/login/page.tsx"
      provides: "Minimal login page with GitHub OAuth button"
      min_lines: 20
    - path: "apps/web/app/(app)/dashboard/page.tsx"
      provides: "Protected dashboard page"
      min_lines: 15
    - path: "apps/web/app/(app)/onboarding/page.tsx"
      provides: "Onboarding welcome page for new users"
      min_lines: 20
    - path: "apps/web/components/providers/theme-provider.tsx"
      provides: "next-themes provider wrapper"
      exports: ["ThemeProvider"]
  key_links:
    - from: "apps/web/app/(auth)/login/page.tsx"
      to: "/api/auth/github"
      via: "anchor href"
      pattern: "href.*api/auth/github"
    - from: "apps/web/app/(app)/dashboard/page.tsx"
      to: "apps/web/lib/dal.ts"
      via: "verifySession call"
      pattern: "verifySession\\(\\)"
    - from: "apps/web/app/layout.tsx"
      to: "apps/web/components/providers/theme-provider.tsx"
      via: "ThemeProvider wrapper"
      pattern: "ThemeProvider"
---

<objective>
Create login, onboarding, and dashboard pages with theme support

Purpose: Complete the user-facing authentication experience. Users land on a minimal login page, authenticate with GitHub, see a brief onboarding welcome (new users), then access the dashboard. Theme toggle provides light/dark mode with light as default.

Output:
- Login page: Ship logo + "Sign in with GitHub" button (Ramp Inspect aesthetic)
- Onboarding page: Welcome message for new users
- Dashboard page: Protected page with user info (placeholder for future sessions list)
- Theme provider and toggle component
- Route groups: (auth) for public, (app) for protected
</objective>

<execution_context>
@/Users/dylansteck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dylansteck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-CONTEXT.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@.planning/phases/01-foundation-authentication/01-01-SUMMARY.md
@.planning/phases/01-foundation-authentication/01-02-SUMMARY.md
@.planning/phases/01-foundation-authentication/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up theme provider and shared button component</name>
  <files>
    apps/web/package.json
    apps/web/components/providers/theme-provider.tsx
    apps/web/components/theme-toggle.tsx
    apps/web/components/ui/button.tsx
    packages/ui/src/button.tsx
    apps/web/app/layout.tsx
    apps/web/app/globals.css
  </files>
  <action>
    Install next-themes and create theme infrastructure:

    1. Add to apps/web/package.json:
       - next-themes@^0.4.6

    2. apps/web/components/providers/theme-provider.tsx:
       ```tsx
       'use client'

       import { ThemeProvider as NextThemesProvider } from 'next-themes'

       export function ThemeProvider({ children }: { children: React.ReactNode }) {
         return (
           <NextThemesProvider
             attribute="class"
             defaultTheme="light"
             enableSystem
             disableTransitionOnChange
           >
             {children}
           </NextThemesProvider>
         )
       }
       ```
       NOTE: defaultTheme is "light" per user requirement

    3. apps/web/components/theme-toggle.tsx:
       - Client component with useTheme hook
       - Toggle button showing current theme icon (sun/moon)
       - Handle mounted state to avoid hydration mismatch

    4. apps/web/components/ui/button.tsx:
       - Simple button component with variants (primary, outline, ghost)
       - Tailwind styling following shadcn/ui patterns
       - Export to be used across app

    5. packages/ui/src/button.tsx:
       - Copy button to shared package for cross-app usage

    6. Update apps/web/app/layout.tsx:
       - Wrap children with ThemeProvider
       - Add suppressHydrationWarning to html tag
       - Import globals.css

    7. Update apps/web/app/globals.css:
       - Add CSS variables for light/dark themes using @theme directive
       - Brand colors for Ship (clean, minimal like Ramp Inspect)
       - :root for light, .dark for dark mode
  </action>
  <verify>
    - App starts without hydration warnings
    - Theme toggle switches between light and dark
    - Light mode is active by default
    - Button component renders correctly
  </verify>
  <done>
    Theme system working with next-themes, button component ready for use
  </done>
</task>

<task type="auto">
  <name>Task 2: Create login page and auth route group</name>
  <files>
    apps/web/app/(auth)/layout.tsx
    apps/web/app/(auth)/login/page.tsx
    apps/web/app/page.tsx
  </files>
  <action>
    Create minimal login experience (Ramp Inspect aesthetic):

    1. apps/web/app/(auth)/layout.tsx:
       - Simple centered layout for auth pages
       - Full height, centered content
       - Clean background

    2. apps/web/app/(auth)/login/page.tsx:
       ```tsx
       import Link from 'next/link'
       import { Button } from '@/components/ui/button'

       export default function LoginPage() {
         return (
           <div className="flex min-h-screen flex-col items-center justify-center">
             <div className="flex flex-col items-center space-y-8">
               {/* Ship logo - text for now, can add SVG later */}
               <div className="text-4xl font-bold tracking-tight">Ship</div>

               {/* GitHub OAuth button */}
               <Link href="/api/auth/github">
                 <Button size="lg" className="gap-2">
                   <GitHubIcon className="h-5 w-5" />
                   Sign in with GitHub
                 </Button>
               </Link>
             </div>
           </div>
         )
       }

       // Simple GitHub icon component
       function GitHubIcon({ className }: { className?: string }) {
         return (
           <svg className={className} viewBox="0 0 24 24" fill="currentColor">
             {/* GitHub logo path */}
           </svg>
         )
       }
       ```

    3. apps/web/app/page.tsx:
       - Redirect to /login if not authenticated
       - Redirect to /dashboard if authenticated
       - Use redirect() from next/navigation
       - Check session with getSession()

    Design notes:
    - Clean, minimal, professional
    - No marketing content - just logo and button
    - Light background, dark text
    - Match Ramp Inspect's understated elegance
  </action>
  <verify>
    - http://localhost:3000/login shows centered Ship logo and GitHub button
    - Clicking "Sign in with GitHub" navigates to /api/auth/github
    - Root page (/) redirects appropriately based on auth state
  </verify>
  <done>
    Login page created with minimal Ship branding and GitHub OAuth button
  </done>
</task>

<task type="auto">
  <name>Task 3: Create onboarding and dashboard pages</name>
  <files>
    apps/web/app/(app)/layout.tsx
    apps/web/app/(app)/onboarding/page.tsx
    apps/web/app/(app)/dashboard/page.tsx
  </files>
  <action>
    Create protected route group with onboarding and dashboard:

    1. apps/web/app/(app)/layout.tsx:
       - Protected layout that wraps all authenticated pages
       - Simple header with Ship logo, theme toggle, user avatar, logout
       - Main content area
       - Call verifySession() to ensure auth (defense in depth)

    2. apps/web/app/(app)/onboarding/page.tsx:
       - Welcome message: "Welcome to Ship"
       - Brief description of what Ship does
       - "Get Started" button that links to /dashboard
       - Optional: username confirmation (Claude's discretion)
       - Call verifySession() at top

       Simple implementation:
       ```tsx
       import { verifySession, getUser } from '@/lib/dal'
       import Link from 'next/link'
       import { Button } from '@/components/ui/button'

       export default async function OnboardingPage() {
         await verifySession()
         const user = await getUser()

         return (
           <div className="flex min-h-screen flex-col items-center justify-center p-4">
             <div className="max-w-md text-center space-y-6">
               <h1 className="text-3xl font-bold">Welcome to Ship, {user.name || user.username}!</h1>
               <p className="text-muted-foreground">
                 Ship is your AI coding assistant that works in the background.
                 Create sessions, assign tasks, and let the agent handle the rest.
               </p>
               <Link href="/dashboard">
                 <Button size="lg">Get Started</Button>
               </Link>
             </div>
           </div>
         )
       }
       ```

    3. apps/web/app/(app)/dashboard/page.tsx:
       - Protected page (call verifySession())
       - Fetch user with getUser()
       - Display welcome message with user info
       - Placeholder for sessions list (Phase 2)
       - Logout button linking to /api/auth/logout

       ```tsx
       import { verifySession, getUser } from '@/lib/dal'
       import Link from 'next/link'
       import { Button } from '@/components/ui/button'

       export default async function DashboardPage() {
         await verifySession()
         const user = await getUser()

         return (
           <div className="p-8">
             <div className="flex items-center justify-between mb-8">
               <h1 className="text-2xl font-bold">Dashboard</h1>
               <div className="flex items-center gap-4">
                 <span className="text-sm text-muted-foreground">
                   {user.username}
                 </span>
                 <Link href="/api/auth/logout">
                   <Button variant="outline" size="sm">Logout</Button>
                 </Link>
               </div>
             </div>

             {/* Sessions list placeholder */}
             <div className="rounded-lg border p-8 text-center text-muted-foreground">
               <p>No sessions yet. Sessions will appear here in Phase 2.</p>
             </div>
           </div>
         )
       }
       ```

    CRITICAL: Every protected page MUST call verifySession() at the top. This is the security layer, not middleware.
  </action>
  <verify>
    - /onboarding shows welcome message and "Get Started" button (requires auth)
    - /dashboard shows user info and placeholder (requires auth)
    - Both pages redirect to /login if accessed without session
    - Logout button works and redirects to login
  </verify>
  <done>
    Onboarding and dashboard pages created with DAL security verification
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

Full auth flow test:
1. Start both apps: `pnpm dev`
2. Navigate to http://localhost:3000
3. Should redirect to /login
4. Click "Sign in with GitHub" -> redirects to GitHub
5. After GitHub auth -> callback creates user -> sets session
6. New user -> redirected to /onboarding
7. Click "Get Started" -> redirected to /dashboard
8. Dashboard shows user info and placeholder
9. Click "Logout" -> session cleared -> redirected to /login

Theme:
- Light mode is default
- Theme toggle switches between light/dark
- Theme persists across page refreshes

Security:
- Direct access to /dashboard without session -> redirect to /login
- Direct access to /onboarding without session -> redirect to /login
</verification>

<success_criteria>
- Login page matches Ramp Inspect aesthetic (minimal, clean)
- GitHub OAuth flow works end-to-end
- New users see onboarding, returning users go to dashboard
- Theme toggle works with light mode default
- All protected pages verify session via DAL
- Logout clears session and redirects
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-04-SUMMARY.md`
</output>
